- hosts: tag_Type_couchbaseserver_data_cluster1 
  vars:
    sudo: yes
    ver_no: "{{VER|default('5.0.0')}}"
    build_no:  "{{BUILD_NO|default(2889)}}"
    flavor:  "{{FLAVOR|default('spock')}}"
    base_url:  http://172.23.120.24/builds/latestbuilds/couchbase-server/{{flavor}}/
    build_pkg: "couchbase-server-enterprise-{{ver_no}}-{{build_no}}-centos6.x86_64.rpm"
    url_var: "{{base_url}}/{{build_no}}/{{build_pkg}}"
    build_url: "{{URL|default(url_var)}}"
    rpm_path: "/tmp/couchbase.rpm"
  remote_user: centos 
  become: yes
  become_method: sudo 
  serial: 20
  tasks:
  - name: download binary
    get_url: url="{{build_url}}" dest="{{rpm_path}}"
  - copy:
      src: "{{rpm_path}}"
      dest: "{{rpm_path}" 
      mode: 0644
  - name: install couchbase
    yum: name="{{rpm_path}}"
  - name: permissions 
    shell: chown couchbase /data && chgrp couchbase /data 
